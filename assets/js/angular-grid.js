/*
    angularGrid.js v 0.3.4
    Author: Sudhanshu Yadav
    Copyright (c) 2015 Sudhanshu Yadav - ignitersworld.com , released under the MIT license.
    Demo on: http://ignitersworld.com/lab/angulargrid/demo1.html
    Documentation and download on https://github.com/s-yadav/angulargrid 
*/

!function(n,t){"use strict";function i(n){return n.complete&&("undefined"==typeof n.naturalWidth||0!==n.naturalWidth)}function a(n){return Array.prototype.slice.call(n)}var e={gridWidth:300,gutterSize:10,refreshOnImgLoad:!0},o=function(){var i=n.element(t);return function(n){return i[0]=n,i}}();n.element(document.head).append("<style>.ag-no-transition{-webkit-transition: none !important;transition: none !important;} .angular-grid{position : relative;} .angular-grid > *{opacity : 0} .angular-grid > .angular-grid-item{opacity : 1}</style>"),n.module("angularGrid",[]).directive("angularGrid",["$timeout","$window","$q","angularGridInstance",function(t,r,d,u){return{restrict:"A",link:function(s,l,g){function f(){var n=w.offsetWidth,t=Math.floor(n/(z.gridWidth+z.gutterSize)),i=n%(z.gridWidth+z.gutterSize)+z.gutterSize,a=z.gridWidth+Math.floor(i/t);return{no:t,width:a}}function c(t,e){var o=e.beforeLoad||n.noop,r=e.onLoad||n.noop,u=e.isLoaded||n.noop,s=e.onFullLoad||n.noop,l=e.ignoreCheck||n.noop,g=t.find("img"),f=[];a(g).forEach(function(n){o(n),i(n)||l(n)?u(n):f.push(d(function(t,i){n.onload=function(){r(n),t()},n.onerror=i}))}),f.length?d.all(f).then(s,s):setTimeout(function(){s()},0)}function h(){var t,i=f(),e=i.width,r=i.no,d=[];for(t=0;r>t;t++)d.push(0);a(v).forEach(function(t){var i=o(t);a(i.find("img")).forEach(function(t){var a=n.element(t);if(a.hasClass("img-loaded"))return void a.css("height","");i.addClass("ag-no-transition"),i.css("width",e+"px");var o=a.attr("actual-width")||a.attr("data-actual-width"),r=a.attr("actual-height")||a.attr("data-actual-height");o&&r&&a.css("height",r*t.width/o+"px")}),i.removeClass("ag-no-transition")});var u=v.clone();u.addClass("ag-no-transition"),u.css({visibility:"hidden",opacity:0,width:e+"px",top:0,left:0}),l.append(u),c(u,{ignoreCheck:function(n){return!o(n).hasClass("img-loaded")},onFullLoad:function(){var n,t,i,a=[];for(t=0,i=u.length;i>t;t++)a.push(u[t].offsetHeight);for(t=0,i=v.length;i>t;t++){n=o(v[t]);var r=a[t],s=Math.min.apply(Math,d),g=d.indexOf(s);d[g]=s+r+z.gutterSize;var f=g*(e+z.gutterSize);n.css({position:"absolute",top:s+"px",left:f+"px",width:e+"px"}).addClass("angular-grid-item")}l.css("height",Math.max.apply(Math,d)+"px"),u.remove()}})}function m(){var i=!1;a(v).forEach(function(a){var e=n.element(a),r=e.find("img");r.length&&(e.addClass("img-loading"),c(e,{beforeLoad:function(n){o(n).addClass("img-loading")},isLoaded:function(n){o(n).removeClass("img-loading").addClass("img-loaded")},onLoad:function(n){!i&&z.refreshOnImgLoad&&(i=!0,t(function(){h(),i=!1},100)),o(n).removeClass("img-loading").addClass("img-loaded")},onFullLoad:function(){e.removeClass("img-loading").addClass("img-loaded")}}))})}function p(){var n=a(v).filter(function(n){return o(n).hasClass("ng-leave")});return d(function(i){n.length?o(n[0]).one("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){t(function(){v=l.children(),i()})}):i()})}var v,C,w=l[0],L=n.element(r),W=g.angularGridId,y=g.angularGrid;l.addClass("angular-grid");var z={gridWidth:g.gridWidth?parseInt(g.gridWidth):e.gridWidth,gutterSize:g.gutterSize?parseInt(g.gutterSize):e.gutterSize,refreshOnImgLoad:"false"==g.refreshOnImgLoad?!1:!0};s.$watch(y,function(){t(function(){v=l.children(),p().then(function(){m(),t(function(){h()})})})},!0);var S=w.offsetWidth;L.on("resize",function(){var n=w.offsetWidth;S!=n&&(S=n,C&&t.cancel(C),C=t(function(){h()},100))}),W&&(u[W]={refresh:h})}}}]).factory("angularGridInstance",function(){var n={};return n})}(angular,window);